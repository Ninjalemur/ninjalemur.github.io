<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Google Sheets techniques (Episode 2) | Gerard's Website </title> <meta name="author" content="Gerard Chan"> <meta name="description" content="Advanced tips for working with Array Formulas"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ninjalemur.github.io/blog/2023/sheets-techniques_002/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Gerard's Website </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Google Sheets techniques (Episode 2)</h1> <p class="post-meta"> Created in May 11, 2023 </p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/spreadsheets"> <i class="fa-solid fa-hashtag fa-sm"></i> spreadsheets</a>   <a href="/blog/tag/arrayformulas"> <i class="fa-solid fa-hashtag fa-sm"></i> arrayformulas</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="contents">Contents</h2> <ul id="markdown-toc"> <li><a href="#contents" id="markdown-toc-contents">Contents</a></li> <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li> <li><a href="#challenges-of-array-formulas" id="markdown-toc-challenges-of-array-formulas">Challenges of array formulas</a></li> <li> <a href="#components-of-map-tab" id="markdown-toc-components-of-map-tab">Components of Map tab</a> <ul> <li><a href="#row-counting" id="markdown-toc-row-counting">Row counting</a></li> <li><a href="#column-checker" id="markdown-toc-column-checker">Column checker</a></li> <li><a href="#creating-a-range-string" id="markdown-toc-creating-a-range-string">Creating a range string</a></li> <li><a href="#nameranges" id="markdown-toc-nameranges">Nameranges</a></li> </ul> </li> <li><a href="#the-map-tab-as-a-map-of-the-data" id="markdown-toc-the-map-tab-as-a-map-of-the-data">The Map tab as a “Map” of the data</a></li> <li><a href="#why-split-the-inventory-into-two-tabs" id="markdown-toc-why-split-the-inventory-into-two-tabs">Why split the Inventory into two tabs?</a></li> <li><a href="#wow-it-seems-like-a-lot-of-work-is-it-worth-it" id="markdown-toc-wow-it-seems-like-a-lot-of-work-is-it-worth-it">Wow, it seems like a lot of work. Is it worth it?</a></li> <li><a href="#how-to-build-upon-the-template" id="markdown-toc-how-to-build-upon-the-template">How to build upon the template</a></li> <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li> </ul> <h2 id="introduction">Introduction</h2> <p>In our previous <a href="www.gerardchan.com/blog/2023/sheets-techniques_001/">episode</a>, we covered some techniques to improve performance and readability for Google Sheets that contain a lot of formulas. One of those techniques was the use of array formulas. However, array formulas do come with their own constraints to manage, and this episode will cover a solution to manage them: the Map tab. Feel free to make a copy the sample use case we’ll be covering from <a href="https://docs.google.com/spreadsheets/d/1WuVGitJQlfCFZmKxCGn5AJar8WfFk8y8pJzQYsZ3svQ" rel="external nofollow noopener" target="_blank">here</a>.</p> <p>In our example use case, we have a spreadsheet that helps compute the total value of an inventory of fruit in local currency. TThe spreadsheet consists of several tabs.</p> <ul> <li>Inventory_Input: The data tab called that will contain data on fruits, with columns for the name of the fruits, the quantity, and the unit price of each fruit in USD</li> <li>Interface: Our user interface tab, which contains a field for users to input a currency exchange number for USD to their local currency, and an output field computing the total value of the fruit inventory in local currency. This output field computes its output based on the data in “Inventory_Input” as well as the exchange rate input from the user</li> <li>CALC_Inventory: A calculation tab which contains calculations</li> <li>MAP: The Map tab, which we will go into more detail later on</li> </ul> <h2 id="challenges-of-array-formulas">Challenges of array formulas</h2> <p>When using array formulas to process data, there are two main ways to refer to the columns that we are using in our computations: full column ranges (eg A:A), or bounded ranges (eg A1:A1000). Each of them have different advantages and drawbacks. Full column ranges have a higher performance overhead, but will dynamically respond to the number of rows changing. Bounded ranges have a lower performance overhead, but by default do not respond dynamically to the number of rows changing.</p> <p>When we have a large spreadsheet with many formulas and columns, it’s important that performance is manageable, and that maintenance is manageable (ie we do not have to manually update many formulas each time the size of the data changes). The Map tab aims to accomplish this.</p> <h2 id="components-of-map-tab">Components of Map tab</h2> <p>The Map tab consists of several key components.</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/sheets_techniques/map_tab-labelled-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/sheets_techniques/map_tab-labelled-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/sheets_techniques/map_tab-labelled-1400.webp"></source> <img src="/assets/img/sheets_techniques/map_tab-labelled.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <ol> <li>A row counter that counts the number of rows in a sheet</li> <li>A column checker that returns the column letter of a given column</li> <li>A string that concatenates sheet name, column, and rows to create a range string (eg Sheet1!A1:A10)</li> <li>Nameranges that refer to the ranges strings in the tab</li> </ol> <p>What the map tab is doing is reducing the number of time full column ranges are called in array formulas from “every time a column is referenced” to “once per data tab”. This drastically reduces the performance overhead while retaining the benefit of dynamically responding to varying number of rows. How does it accomplish this via each of the components? Let’s step through each of them to find out.</p> <h3 id="row-counting">Row counting</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=ARRAYFORMULA(
    MAX(
        IF(
            LEN(Inventory_Input!A:A),
            ROW(Inventory_Input!A:A),
            )
        )
    )
</code></pre></div></div> <p>This row counting formula helps to find the maximum row in the input data tab that contains data. The row number returned will then be referenced by other formulas to generate bounded range strings without having to each utilise a full column range reference.</p> <h3 id="column-checker">Column checker</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=REGEXEXTRACT(
    ADDRESS(
        1,
        COLUMN(Inventory_Input!A$1)
        ),
    "[A-Z]+"
    )
</code></pre></div></div> <p>This formula extracts the column letter of a given column. The reason why we formularise this instead of entering a letter like “A” directly is to allow the column reference to shift left or right if we insert or delete columns. For example, if a column was inserted to to left of column A, our example reference above would start returning B instead of A. This implementation helps to reduce the maintenance needed as we expand our spreadsheet.</p> <h3 id="creating-a-range-string">Creating a range string</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=CONCATENATE(
    "'",
    $B$6,
    "'!",
    B9,
    $B$3,
    ":",
    B9,
    $B$4
    )
</code></pre></div></div> <p>This formula concatenates the sheet name, column letter, and row numbers together into a range string that we can use in formulas. As the number of data rows or the columns change, the row counter and column checkers will update, and update this range string accordingly, allowing us the benefit of increased performance of bounded column ranges for our array formulas, while managing the downside of maintenance overhead.</p> <h3 id="nameranges">Nameranges</h3> <p>As is good practice, we give each of our ranges a name to refer to them by. It’s much easier to understand what INDIRECT(MAP_INVENTORY_QTY) * INDIRECT(MAP_INVENTORY_UNITPRICE_LOCAL) means, compared to INDIRECT(MAP!C10) * INDIRECT(MAP!C17).</p> <h2 id="the-map-tab-as-a-map-of-the-data">The Map tab as a “Map” of the data</h2> <p>The map tab contains all the range strings for all the data in the entire spreadsheet. It provides a central place to look up what data a spreadsheet contains, and where it is located. This is extremely helpful for human readability, not just for making our formulas work. If we wanted to, we could even add a “Description” column where we can describe the contents of each column and turn the Map tab into a data dictionary.</p> <h2 id="why-split-the-inventory-into-two-tabs">Why split the Inventory into two tabs?</h2> <p>The Inventory data is split across two tabs, “Inventory_Input” and “CALC_Inventory”. This is to segregate input data that comes from an external source or the user, from data that is entirely generated by formulas. With this segregation, users can feel comfortable inspecting and correcting data in data tabs, without the stress of working in a tab where some columns are data they can modify, and other columns are formulas that they have to be careful not to break.</p> <p>From a data model standpoint, the two tabs can be considered the same “data frame”. They contain the same number of rows, and the n-th row in “Inventory_Input” refers to the n-th row “CALC_Inventory”. I chose to name the named ranges for columns in both these tabs with the same “MAP_INVENTORY” prefix to convey them as both being part of the Inventory table.</p> <h2 id="wow-it-seems-like-a-lot-of-work-is-it-worth-it">Wow, it seems like a lot of work. Is it worth it?</h2> <p>It depends. For one-off spreadsheets that take less than 15 minutes to build, and that you will almost never look at again, it’s absolutely not worth it to take this much effort to implement a map tab. However, if your spreadsheet takes more than a few hours to build, and it’s something you want to come back to to review or build upon, or you need to hand over to someone else, then it’s absolutely worth it. I’ve used these techniques in a professional setting, and it’s made onboarding new team members and allowing them to build upon existing assets much easier. It’s allowed me to come back to personal projects like the savings calculator two years after last working on it and quickly re-familiarising with it to build an updated version.</p> <p>Remember, code spends 90% of its time being read, 10% of its time being written. Making that 90% easier is a huge benefit.</p> <h2 id="how-to-build-upon-the-template">How to build upon the template</h2> <p>All this setup is to make expanding on the existing spreadsheet easier. But what exactly do you need to do to expand the spreadsheet?</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/sheets_techniques/map_tab-expand-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/sheets_techniques/map_tab-expand-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/sheets_techniques/map_tab-expand-1400.webp"></source> <img src="/assets/img/sheets_techniques/map_tab-expand.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>If you wanted to add more columns to the Inventory table, you would add more rows at 1 (pictured above) for data input columns, and more rows at 2 (pictured above) if you wanted to add more calculated columns.</p> <p>If you wanted to add more data tables, you could copy the entire block from A1 to C18, and paste them into new rows below. Remember to update the “data table” name from “Inventory” to your new data table name, the sheet names to your new sheet names, as well as the formula references in all the pale blue cells.</p> <h2 id="conclusion">Conclusion</h2> <p>The Map tab is a setup that can help make large spreadsheets easier to manage, AND speed them up. Spreadsheets are a powerful tool for creating number crunchers that take in user input. Keeping your spreadsheets responsive and easy to maintain will make your work more productive. Don’t forget to apply the techniques learnt here and in our previous <a href="www.gerardchan.com/blog/2023/sheets-techniques_001/">episode</a>!</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/displaying-external-posts-on-your-al-folio-blog/">Displaying External Posts on Your al-folio Blog</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/sheets-techniques_001/">Google Sheets techniques for performance and readability</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/food-dashboard_001/">Food Dashboard is live!</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/food-sharing-template_001/">Food Sharing Template is live!</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/wh40k_asim_sheet_001_v01_live/">Warhammer 40k 9th Edition Attack Simulator Spreadsheet v 0.1 is live!</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Gerard Chan. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>